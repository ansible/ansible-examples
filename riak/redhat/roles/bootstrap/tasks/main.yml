---
- name: mount the riak volume with optmized settings
  mount: name={{ riak.mountpoint }} src={{ riak.partition }} opts="noatime,barrier=0,errors=remount-ro" fstype=ext4 state=mounted

- name: confgure rc.local
  template: src=etc_rc.local.j2 dest=/etc/rc.local owner=root group=root mode=0755
  notify: source rclocal

- name: create sysctl.d
  file: dest=/etc/sysctl.d state=directory
- name: configure sysctl
  copy: src=etc_sysctl.d_riak.conf dest=/etc/sysctl.d/riak.conf owner=root group=root mode=0644
  notify: update sysctl

- name: fetch yum repository
  get_url: url=http://yum.basho.com/gpg/basho-release-6-1.noarch.rpm dest=/tmp

- name: configure the basho repository
  yum: name=/tmp/basho-release-6-1.noarch.rpm

- name: install riak, riak-cs
  yum: name=$item state=present
  with_items:
  - riak
  - riak-cs